<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>D3D11DRV: Deus Ex Direct3D 11 driver</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li class="current"><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Deus Ex Direct3D 11 driver</h1><p>Marijn Kentie 2009 <br/>
</p>
<p>Welcome to the D3D10 renderer documentation. Simplicity and documentation were a major focus; I hope I have been succesful in those regards.</p>
<h2><a class="anchor" id="layout">
Project layout (also see 'project layout.pdf')</a></h2>
<ul>
<li>D3D11Drv.cpp is the renderer interface, implements the URenderDevice subclass <a class="el" href="class_u_d3_d11_render_device.html">UD3D11RenderDevice</a>. The documentation for this class explains the game&lt;-&gt;renderer interface.</li>
<li>d3d.cpp deals with graphics API. <a class="el" href="class_d3_d.html">D3D</a> class. Initialization, setting up shaders, creating texture objects, etc, etc. Implements the texture cache. Exposes various API-neutral structures with which the renderer interface can pass data.</li>
<li>texconversion.cpp is the glue that prepares Unreal textures to be saved in the <a class="el" href="class_d3_d.html">D3D</a> texture cache. Assigns or converts textures to formats <a class="el" href="class_d3_d.html">D3D</a> can work with. <a class="el" href="class_tex_conversion.html">TexConversion</a> class.</li>
</ul>
<p>An effort was made to keep the renderer interface reasonably API neutral. Ports to future Direct3D versions should only influence the <a class="el" href="class_d3_d.html">D3D</a> and to a lesser extent <a class="el" href="class_tex_conversion.html">TexConversion</a> classes.</p>
<h2><a class="anchor" id="libs">
Required libraries:</a></h2>
<ul>
<li>Aug 2009 DirectX SDK</li>
<li>D3DX11 Effects framework headers (comes with DirectX SDK, i.e. C: Files (x86) DirectX SDK (August 2009)\) These should be added to the Visual Studio include/lib directories.</li>
<li>Core and engine headers/libs for the various supported games.</li>
</ul>
<h2><a class="anchor" id="buildset">
Build settings.</a></h2>
<ul>
<li>Struct member alignment must be set to 4 bytes.</li>
<li>Project must be set to unicode, but with wchar_t not as built-in type.</li>
<li>See the solution documentation for information on how the Visual Studio solution is set up.</li>
</ul>
<h2><a class="anchor" id="renderer">
Renderer.</a></h2>
<p>An Unreal renderer takes care of the following:</p>
<ul>
<li>Initialize and care for the graphics API.</li>
<li>Handle resizing of buffers, fullscreen mode.</li>
<li>Set scene: projection, viewport.</li>
<li>Implement a texture cache, convert textures to API supported format</li>
<li>Draw geometry, meanwhile applying textures and setting state such as blending.</li>
<li>Misc. tasks, such as returning a dump of the back buffer.</li>
</ul>
<p>Geometry is sent worldview transformed and viewport clipped. Maps are lit using lightmaps; 3d models are per-vertex gouraud shaded.</p>
<h2><a class="anchor" id="glue">
Unreal Engine glue</a></h2>
<p>To integrate with the engine the renderer must:</p>
<ul>
<li>Provide an .int file describing its name etc. This is required to be able to pick the renderer in the game options and to set its advanced preferences.</li>
<li>Use the DECLARE_CLASS() macro inside its class declaration.</li>
<li>Use the IMPLEMENT_PACKAGE() and IMPLEMENT_CLASS() macros.</li>
<li>Have an extra letter in front of its name. If the renderer is set to "D3D10RenderDevice", the game will look for the "UD3D11RenderDevice" class.</li>
<li>Link against the game's core and engine libraries.</li>
<li>Be built with correct <a class="el" href="index.html#buildset">Build settings.</a>.</li>
</ul>
<h2><a class="anchor" id="lifecycle">
Lifecycle</a></h2>
<p>Renderer lifecycle. Whatever renderer is running takes the place of URenderDevice:</p>
<ul>
<li>First the constructor URenderDevice::StaticConstructor() is called. Here 'advanced options' window preferences must be bound.</li>
<li>URenderDevice::Init() is called. API initialization, setting up parameters etc. The renderer is reinitialized when switching to fullscreen.</li>
<li>If URenderDevice::PrecacheOnFlip is set, URenderDevice::PrecacheTexture() calls are made to cache textures.</li>
<li>URenderDevice::Lock() is called. The back and depth buffer are cleared and the renderer prepares for new data.</li>
<li>If needed, URenderDevice::SetSceneNode() calls are made to set up projection and viewport.</li>
<li>Geometry is sent using URenderDevice::DrawComplexSurface(), URenderDevice::DrawGouraudPolygon() and URenderDevice::DrawTile().</li>
<li>Between geometry sends, URenderDevice::ClearZ() is used to clear the depth buffer. This way, the skybox is drawn in the back and weapon models at the front.</li>
<li>URenderDevice::Unlock() is called. The scene should be drawn. </li>
</ul>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Sat Oct 3 23:35:35 2009 for D3D11DRV by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
